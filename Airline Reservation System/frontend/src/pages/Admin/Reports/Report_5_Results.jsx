import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { Container, Box } from '@mui/material';
import Button from '@mui/material/Button';
import { DataGrid, GridColDef } from '@mui/x-data-grid';
import Grid from '@mui/material/Grid';

const Report_5_Results = () => {
    const [models, setModels] = useState([]);
    const [isButtonHidden, setIsButtonHidden] = useState(false);

    useEffect(() => {
        const fetchALLModels = async () => {
            try {
                await axios.post("http://localhost:8000/boarding");
                await axios.post("http://localhost:8000/in_air");
            } catch (err) {
                console.log(err);
            }
            try {
                const res = await axios.get("http://localhost:8000/report_5");
                setModels(res.data);
                console.log(res);
            } catch (err) {
                console.log(err);
            }
        }
        fetchALLModels();
    }, []);

    const printPage = () => {
        window.print();
    };

    const combineEvent = () => {
        setIsButtonHidden(true);
        setTimeout(() => {
            printPage();
        }, 50); 
        setTimeout(() => {
            setIsButtonHidden(false);
        }, 1000); 
    };
    

    const rows = models.map(model => ({
        id: model.model_id,
        brand: model.brand,
        model: model.model,
        revenue: model.total_revenue
    }));

    const columns = [
        {
            field: 'id',
            headerName: 'Model ID',
            flex: 1
        }, {
            field: 'brand',
            headerName: 'Brand',
            flex: 1
        }, {
            field: 'model',
            headerName: 'Model',
            flex: 1
        }, {
            field: 'revenue',
            headerName: 'Revenue',
            flex: 1
        }
    ];

    return (
        <Container>
            <Box component="main" sx={{ flexGrow: 1, paddingTop: 4.5 }}>
                <Box component="main" sx={{ flexGrow: 1 }}>
                    <Grid>
                        <h1>Revenue Generated by each Aircraft Model
                            {!isButtonHidden && (
                                <Button
                                    id="myButton"
                                    variant="contained"
                                    onClick={combineEvent}
                                    style={{
                                        float: 'right',
                                        backgroundColor: '#000000'
                                    }}
                                >
                                    Print Report
                                </Button>
                            )}
                        </h1>
                    </Grid>
                </Box>

                <div className="models">
                    <Box
                        sx={{
                            width: '100%',
                            marginTop: '5vh'
                        }}
                    >
                        <DataGrid
                            rows={rows}
                            columns={columns}
                            initialState={{
                                pagination: {
                                    paginationModel: {
                                        pageSize: 100
                                    }
                                }
                            }}
                            pageSizeOptions={[5]}
                            checkboxSelection
                            disableRowSelectionOnClick
                        />
                    </Box>
                </div>
            </Box>
        </Container>
    );
};

export default Report_5_Results;
